{% extends "base.html" %} {% block extrahead %}
<!-- Prevent search engine indexing -->
<meta name="robots" content="noindex, nofollow" />

<!-- Netlify Identity Widget -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
{% endblock %} {% block scripts %} {{ super() }}

<!-- Netlify Identity Login Logic -->
<script>
  if (window.netlifyIdentity) {
    const reloadFlagKey = "netlify-login-redirect";
    const skipReload = sessionStorage.getItem(reloadFlagKey) === "true";

    if (skipReload) {
      // Clear once we have reloaded to avoid repeated triggers.
      sessionStorage.removeItem(reloadFlagKey);
    }

    window.netlifyIdentity.on("init", (user) => {
      if (!user) {
        // Open login modal if not authenticated
        window.netlifyIdentity.open();
      }
    });

    window.netlifyIdentity.on("login", () => {
      window.netlifyIdentity.close();

      if (skipReload) {
        // User session already refreshed, so skip another reload.
        return;
      }

      sessionStorage.setItem(reloadFlagKey, "true");
      window.location.reload();
    });

    window.netlifyIdentity.on("logout", () => {
      sessionStorage.removeItem(reloadFlagKey);
      window.location.reload();
    });
  }
</script>
{% endblock %}
